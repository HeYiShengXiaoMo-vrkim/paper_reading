## 标题
### **一种基于时序特征融合的微服务集群故障预警方法**

## 摘要
本发明公开一种基于时序特征融合的微服务集群故障预警方法。该方法首先采集智能电网微服务集群的性能指标、日志文本和调用链路等多维度时序数据，构建统一的时序特征矩阵；其次，采用改进的时空注意力机制对异构特征进行动态加权融合，并结合增量学习机制动态更新特征库，以提取具有时序关联性的异常模式并优化故障特征表征；最后，将提取的异常模式送入层次化预警模型，实现故障严重度的分级预警。本发明通过多维特征的协同分析与动态自适应学习，有效解决了传统静态方法在复杂微服务环境中适应性不足的问题，显著提升了预警的准确性和时效性，并能成功识别跨服务的级联故障。

## 权利要求书

1.  一种基于时序特征融合的微服务集群故障预警方法，其特征在于，所述方法包括以下步骤：
    第一步，采集智能电网编排系统中微服务集群的多维度运行指标数据，包括性能指标、日志文本和服务调用链路数据，构建时序特征矩阵；
    第二步，采用改进的时空注意力机制对所述时序特征矩阵中的异构特征进行动态加权融合，提取具有时序关联性的异常模式，并基于增量学习机制动态更新特征库，持续优化故障特征表征；
    第三步，以上述得到的异常模式和故障特征表征作为输入，通过层次化预警模型对异常模式进行分析，实现故障严重度分级预警。

2.  根据权利要求1所述的基于时序特征融合的微服务集群故障预警方法，其特征在于，采集的多维度运行指标数据分为三类：
    第一类为性能指标，即数值型数据，包括服务器CPU利用率、内存占用率、网络吞吐量、磁盘I/O延迟以及服务响应时间；
    第二类为日志文本，即文本型数据，包含编排指令执行失败日志、数据同步超时日志、服务异常终止记录和API调用失败信息；
    第三类为服务编排链路数据，即拓扑型数据，涵盖跨微服务调用延迟、编排成功率、微服务之间的依赖关系拓扑以及请求流量波动。

3.  根据权利要求2所述的基于时序特征融合的微服务集群故障预警方法，其特征在于，设采集时长为T，采样间隔为Δt，则时间戳序列为t_1, t_2, ..., t_T；将性能指标表示为向量Z，日志文本通过自然语言处理转化为向量L，服务编排链路数据转化为邻接矩阵A；基于上述三类异构特征，将不同时间点的特征整合形成时序特征矩阵M，其结构如下：
    $$
    M = \begin{bmatrix}
    Z(t_1) & L(t_1) & A(t_1) \\
    Z(t_2) & L(t_2) & A(t_2) \\
    \vdots & \vdots & \vdots \\
    Z(t_T) & L(t_T) & A(t_T)
    \end{bmatrix} \in \mathbb{R}^{T \times (m+n+s^2)}
    $$
    其中m为性能指标维度，n为日志向量维度，s为微服务节点数。

4.  根据权利要求3所述的基于时序特征融合的微服务集群故障预警方法，其特征在于，所述改进的时空注意力机制包括：
    计算空间注意力权重W_space，用于突出对故障影响显著的特征维度：
    $$
    W_{space} = \text{Softmax}\left(\frac{Q \cdot K^T}{\sqrt{d_k}} + b_{space}\right)
    $$
    计算时间注意力权重W_time，用于捕捉不同时间点特征的依赖关系：
    $$
    W_{time} = \text{Softmax}\left(\frac{Q_t \cdot K_t^T}{\sqrt{d_t}} + \text{PositionalEncoding}(t) + b_{time}\right)
    $$
    将上述两个权重与时序特征矩阵M进行动态加权融合，得到融合后的特征矩阵M'：
    $$
    M' = W_{time} \cdot (M \cdot W_{space})
    $$
    其中，Q、K、Q_t、K_t为查询矩阵和键矩阵，d_k、d_t为归一化维度，b_space、b_time为偏置项。

5.  根据权利要求3所述的基于时序特征融合的微服务集群故障预警方法，其特征在于，所述基于增量学习机制的特征库更新包括：
    首先，采用孤立森林算法对新数据进行异常检测，当样本x的异常概率P_ano(x) > θ时，标记为新增异常模式样本；
    接着，采用在线梯度下降算法，通过最小化一个包含交叉熵损失和KL散度的复合损失函数L(w)来优化特征库权重w；
    然后，引入记忆回放模块，从历史特征库中筛选关键样本，保留历史核心特征信息M_mem；
    最后，将新增异常模式特征与历史保留特征进行加权融合，得到更新后的特征库M_new：
    $$
    M_{new} = \lambda \cdot M' + (1 - \lambda) \cdot M_{mem}
    $$
    其中，θ为异常判定阈值，λ为更新因子。

6.  根据权利要求1所述的基于时序特征融合的微服务集群故障预警方法，其特征在于，所述层次化预警模型包括：
    轻量级异常检测模块：基于融合后的特征矩阵M'，采用局部离群因子算法计算样本的离群分数LOF(x)，当LOF(x)大于第一级阈值时，判定为潜在异常；
    深度故障分类模块：采用时序卷积网络对潜在异常样本的M'进行细粒度分类，输出故障类型概率分布P；
    预警分级决策模块：结合故障类型概率P、故障影响范围与性能下降程度，按照预设规则生成一级（低风险）、二级（中风险）和三级（高风险）预警。

## 技术说明书

#### **【技术领域】**

[0001] 本发明涉及智能电网微服务架构与故障预警技术领域，尤其涉及一种基于时序特征融合的微服务集群故障预警方法。

#### **【背景技术】**

[0002] 在智能电网编排系统中，微服务集群的稳定运行直接关系到电力核心业务的连续性。随着智能电网向云原生架构转型，微服务集群规模不断扩大，服务间调用关系日趋复杂，传统基于静态阈值的故障预警方法已难以满足需求。

[0003] 现有故障预警技术主要存在以下局限性：一方面，传统方法通常采用固定阈值或单一维度指标进行监测，无法有效捕捉微服务间复杂的时空关联特征，在电网负荷高峰时段容易导致误报，而在低谷期又可能遗漏潜在故障。另一方面，当前多数预警系统缺乏对微服务动态演化的适应能力，当电网业务调整导致微服务拓扑变化时，预警模型需要人工重新训练，响应明显滞后。

[0004] 现有技术未能充分挖掘性能指标、日志和调用链路这三类异构特征间的关联规律，导致故障预警的时效性和准确性不足。本发明通过设计一种能够融合多维时序特征并自适应更新特征库的方法，旨在实现对微服务故障的早期、精准预警，从而有效提升系统的可靠性。

#### **【发明内容】**

[0005] 本发明的目的在于克服现有技术的上述缺陷，解决现有预警技术中存在的多维特征融合不足、动态适应性差以及预警精度低的问题。

[0006] 为实现上述目的，本发明采取的技术方案如下：一种基于时序特征融合的微服务集群故障预警方法，该方法包括以下步骤：

[0007] **第一步，多维异构数据采集与特征矩阵构建。**
采集智能电网编排系统中微服务集群的多维度运行指标数据，具体划分为三类：一是性能指标（数值型），如CPU利用率、服务响应时间等；二是日志文本（文本型），如指令执行失败、服务异常终止等记录；三是服务调用链路数据（拓扑型），如跨服务调用延迟、依赖关系拓扑等。对采集的数据进行预处理和向量化后，按时间顺序对齐，构建一个统一的时序特征矩阵，为后续的关联分析提供数据基础。

[0008] **第二步，基于时空注意力与增量学习的特征融合与优化。**
本步骤包含两个核心机制。首先，通过一个改进的时空注意力机制对时序特征矩阵进行处理。该机制解耦空间维度（不同特征之间）和时间维度（不同时间点之间）的注意力计算，分别生成空间注意力权重和时间注意力权重，从而动态地为不同特征和不同时间点分配不同的重要性，最终将二者融合，得到一个能突显关键故障模式的加权特征矩阵。其次，引入一个基于增量学习的特征库动态更新机制。该机制能够自动检测新出现的异常模式，并利用在线梯度下降和记忆回放技术，在不遗忘历史知识的前提下，将新模式融入现有特征库，使模型能够持续适应系统状态的变化。

[0009] **第三步，基于层次化模型的故障分级预警。**
将第二步输出的优化后特征表征作为输入，通过一个三级架构的层次化预警模型进行分析。第一级，使用轻量级的局部离群因子算法进行快速初筛，识别出潜在异常。第二级，对潜在异常样本，启用深度时序卷积网络进行细粒度的故障分类，精确判断故障的具体类型。第三级，结合故障分类结果、影响的服务范围和性能下降的幅度，根据预设的决策规则，最终输出一级（低风险）、二级（中风险）或三级（高风险）的预警，为运维人员提供明确、可操作的决策支持。

#### **【附图说明】**

[0010] **图1** 是本发明所述的微服务集群故障预警方法的整体流程图。
[0011] **图2** 是本发明所述的时空注意力机制的计算与融合流程示意图。
[0012] **图3** 是本发明所述的基于增量学习的特征库更新流程图。
[0013] **图4** 是本发明所述的层次化预警模型的三级架构示意图。

#### **【具体实施方式】**

[0014] 下面将结合附图和具体实施例，对本发明作进一步的详细说明。

[0015] 本发明所述方法的具体实施步骤如下：

[0016] **步骤一：数据采集与特征矩阵构建（参照图1）。**
首先，以固定的时间间隔（例如1分钟）采集智能电网微服务集群的三类数据：性能指标、日志文本和服务调用链路数据。对采集到的原始数据进行预处理：性能指标进行归一化；日志文本通过NLP技术（如Word2Vec）提取关键词并转换为嵌入向量；服务调用链路数据整理成邻接矩阵。然后，将同一时间窗口内的三类特征向量横向拼接，再将连续时间窗口的拼接向量纵向堆叠，形成一个时序特征矩阵M，该矩阵完整地描述了系统在一段时间内的运行状态。

[0017] **步骤二：特征融合与优化（参照图2和图3）。**
将时序特征矩阵M输入到时空注意力模块。该模块并行计算空间注意力权重W_space和时间注意力权重W_time。W_space用于识别在同一时刻哪些特征（如某个服务的CPU占用率和另一服务的API调用失败日志）对故障的指示性最强。W_time则用于捕捉故障演化的时序模式（如CPU利用率先升高，随后出现调用延迟，最后产生大量错误日志）。将两个权重与原始特征矩阵M相乘，得到融合后的特征矩阵M'。
同时，增量学习模块持续监控新采集的数据。它使用孤立森林算法快速识别潜在的新异常样本。一旦发现，便触发特征库更新流程，利用在线梯度下降算法调整模型权重以学习新模式，并通过记忆回放机制确保不遗忘旧的故障特征，最终生成一个动态演进、持续优化的特征库。

[0018] **步骤三：层次化预警（参照图4）。**
将融合后的特征矩阵M'送入层次化预警模型。
1.  **轻量级异常检测**：首先，局部离群因子（LOF）算法对M'进行计算，快速过滤掉绝大部分正常数据，仅将LOF分数超过阈值（如1.5）的样本标记为“潜在异常”，送入下一阶段。
2.  **深度故障分类**：对“潜在异常”样本，启动时序卷积网络（TCN）进行分析。TCN通过其因果卷积结构，能有效捕捉特征随时间演变的依赖关系，从而精确地将异常归类到具体的故障类型（如“数据库连接池耗尽”、“消息队列堵塞”等），并输出每种类型的概率。
3.  **预警分级决策**：最后，决策模块根据TCN输出的最高故障概率、受影响的服务数量以及关键性能指标的下降幅度，进行综合判定。例如，若最高概率低于0.6且仅单个服务性能轻微下降，则发出一级（低风险）预警；若最高概率大于0.8且多个核心服务链路性能下降超过30%，则发出三级（高风险）预警。
<!--stackedit_data:
eyJoaXN0b3J5IjpbLTc2MDQwMjk4NF19
-->